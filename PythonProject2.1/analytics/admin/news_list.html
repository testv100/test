<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% extends "analytics/base.html" %}
{% block title %}Управление новостями{% endblock %}

{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
  <h1 class="h3 mb-0"><i class="bi bi-newspaper me-2"></i>Новости</h1>
  <a class="btn btn-primary" href="{% url 'analytics:news_admin_create' %}">
    <i class="bi bi-plus-lg me-1"></i>Добавить
  </a>
</div>

<form class="row g-2 mb-3" method="get">
  <div class="col-12 col-lg-7">
    <div class="input-group">
      <span class="input-group-text"><i class="bi bi-search"></i></span>
      <input class="form-control" name="q" value="{{ q }}" placeholder="Поиск: заголовок, текст, источник">
    </div>
  </div>
  <div class="col-12 col-lg-3">
    <select class="form-select" name="status">
      <option value="" {% if not status %}selected{% endif %}>Все</option>
      <option value="published" {% if status == "published" %}selected{% endif %}>Опубликованные</option>
      <option value="hidden" {% if status == "hidden" %}selected{% endif %}>Скрытые</option>
    </select>
  </div>
  <div class="col-12 col-lg-2 d-grid">
    <button class="btn btn-outline-primary" type="submit">
      <i class="bi bi-funnel me-1"></i>Применить
    </button>
  </div>
</form>

<div class="card">
  <div class="table-responsive">
    <table class="table align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>Заголовок</th>
          <th class="text-nowrap">Статус</th>
          <th class="text-nowrap">Дата</th>
          <th class="text-end text-nowrap">Действия</th>
        </tr>
      </thead>
      <tbody>
      {% for n in page_obj %}
        <tr>
          <td style="min-width: 320px;">
            <div class="fw-semibold">{{ n.title }}</div>
            <div class="text-muted small">
              {% if n.source %}<i class="bi bi-link-45deg me-1"></i>{{ n.source }}{% endif %}
              {% if n.source_url %}
                <span class="ms-2">
                  <i class="bi bi-box-arrow-up-right me-1"></i>{{ n.source_url|truncatechars:45 }}
                </span>
              {% endif %}
            </div>
          </td>

          <td class="text-nowrap">
            {% if n.is_published %}
              <span class="badge text-bg-success"><i class="bi bi-eye me-1"></i>Опублик.</span>
            {% else %}
              <span class="badge text-bg-secondary"><i class="bi bi-eye-slash me-1"></i>Скрыта</span>
            {% endif %}
          </td>

          <td class="text-nowrap text-muted small">
            {{ n.created_at|date:"d.m.Y H:i" }}
          </td>

          <td class="text-end text-nowrap">
            <a class="btn btn-sm btn-outline-secondary"
               href="{% url 'analytics:news_admin_toggle_publish' n.id %}">
              {% if n.is_published %}
                <i class="bi bi-eye-slash me-1"></i>Скрыть
              {% else %}
                <i class="bi bi-eye me-1"></i>Опубликовать
              {% endif %}
            </a>
            <a class="btn btn-sm btn-outline-primary"
               href="{% url 'analytics:news_admin_edit' n.id %}">
              <i class="bi bi-pencil me-1"></i>Правка
            </a>
            <a class="btn btn-sm btn-outline-danger"
               href="{% url 'analytics:news_admin_delete' n.id %}">
              <i class="bi bi-trash me-1"></i>Удалить
            </a>
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="4" class="text-center text-muted py-4">Ничего не найдено.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% if page_obj.paginator.num_pages > 1 %}
<nav class="mt-3">
  <ul class="pagination">
    {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?q={{ q }}&status={{ status }}&page={{ page_obj.previous_page_number }}">←</a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">←</span></li>
    {% endif %}

    <li class="page-item disabled">
      <span class="page-link">
        Стр. {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
      </span>
    </li>

    {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?q={{ q }}&status={{ status }}&page={{ page_obj.next_page_number }}">→</a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">→</span></li>
    {% endif %}
  </ul>
</nav>
{% endif %}
{% endblock %}
</title>
</head>
<body>

</body>
</html>