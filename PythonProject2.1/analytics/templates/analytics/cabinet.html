{% extends "analytics/base.html" %}
from django.db.models import Count
from .models import Student, Group, Result

total_students = Student.objects.count()
total_groups = Group.objects.count()
total_results = Result.objects.count()

context.update({
    "total_students": total_students,
    "total_groups": total_groups,
    "total_results": total_results,
})
<div class="row g-3 mb-3">
  <div class="col-md-4">
    <div class="card"><div class="card-body">
      <div class="text-muted small">Студентов</div>
      <div class="h4 mb-0">{{ total_students }}</div>
    </div></div>
  </div>
  <div class="col-md-4">
    <div class="card"><div class="card-body">
      <div class="text-muted small">Групп</div>
      <div class="h4 mb-0">{{ total_groups }}</div>
    </div></div>
  </div>
  <div class="col-md-4">
    <div class="card"><div class="card-body">
      <div class="text-muted small">Записей результатов</div>
      <div class="h4 mb-0">{{ total_results }}</div>
    </div></div>
  </div>
</div>

{% block title %}Личный кабинет{% endblock %}

{% block content %}
<div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
  <h1 class="h3 mb-0">Личный кабинет</h1>
  <span class="text-muted small">Пользователь: {{ user.username }}</span>
</div>

<div class="row g-3">
  <div class="col-lg-6">
    <div class="card">
      <div class="card-header">Профиль</div>
      <div class="card-body">
        <div><strong>Логин:</strong> {{ user.username }}</div>
        <div><strong>ФИО:</strong> {{ user.get_full_name|default:"—" }}</div>
        <div><strong>Email:</strong> {{ user.email|default:"—" }}</div>
        <div class="mt-2">
          <strong>Роль:</strong>
          {% if is_manager %}Администратор{% elif is_teacher %}Преподаватель{% else %}Студент{% endif %}
        </div>
      </div>
    </div>

    <div class="card mt-3">
      <div class="card-header">Доступные действия</div>
      <div class="card-body d-grid gap-2">
        <a class="btn btn-primary" href="{% url 'analytics:dashboard' %}">Перейти в аналитику</a>
        <a class="btn btn-outline-secondary" href="{% url 'analytics:export_results' %}">Экспорт CSV</a>
        <a class="btn btn-outline-secondary" href="{% url 'analytics:export_pdf' %}">Экспорт PDF</a>
        {% if is_manager %}
          <a class="btn btn-outline-warning" href="{% url 'analytics:upload_results' %}">Импорт CSV</a>
          <a class="btn btn-outline-warning" href="{% url 'analytics:audit_log' %}">Аудит</a>
          <a class="btn btn-outline-warning" href="{% url 'analytics:teacher_links' %}">Привязки</a>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card">
      <div class="card-header">Справка</div>
      <div class="card-body">
        <ul class="mb-0">
          <li><a href="{% url 'analytics:info' 'about' %}">Сведения</a></li>
          <li><a href="{% url 'analytics:info' 'sitemap' %}">Карта сайта</a></li>
          <li><a href="{% url 'analytics:info' 'privacy' %}">Политика ПДн</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}
